## -------------------------------------------------------------------------------------------------
## -- Colors
## -------------------------------------------------------------------------------------------------
RED         = "\e[1;31m"
GREEN       = "\e[1;32m"
YELLOW      = "\e[1;33m"
BLUE        = "\e[1;34m"
RESET_COLOR = "\e[0m"


## -------------------------------------------------------------------------------------------------
## -- Project directories
## -------------------------------------------------------------------------------------------------
DIR  = ./build/
DIR += ./build/dep/
DIR += ./build/obj/


## -------------------------------------------------------------------------------------------------
## -- Commands + default
## -------------------------------------------------------------------------------------------------
.PHONY : all build build-module run clean purge test test-proj test-module

all : build


## -------------------------------------------------------------------------------------------------
## -- Build, run and clean project
## -------------------------------------------------------------------------------------------------
build : $(DIR)
	@$(MAKE) --no-print-directory -C src build

build-module : $(DIR)
	@$(MAKE) --no-print-directory -C src build-module

run :
	@$(MAKE) --no-print-directory -C src run

clean :
	@$(MAKE) --no-print-directory -C src clean

purge :
	@printf "%b[CLEAN] %b" $(RED) $(RESET_COLOR)
	rm -rf build/


## -------------------------------------------------------------------------------------------------
## -- Build project directories
## -------------------------------------------------------------------------------------------------
./% :
	@printf "%b[  DIR] %b" $(YELLOW) $(RESET_COLOR)
	mkdir -p $@


## -------------------------------------------------------------------------------------------------
## -- Testing
## -------------------------------------------------------------------------------------------------
test :
	@$(MAKE) --no-print-directory test-proj
	@$(MAKE) --no-print-directory test-module

test-proj : purge build run
test-module : purge build-module run


